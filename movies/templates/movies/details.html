{% extends "movies/layout.html" %} 
{% block body %} 
{% load static %}

<a href="javascript:history.back()">Back to results</a>

<!-- <a href="{% url 'search' %}">Back</a> -->

<div class="container">
   <h1>{{item.title}}</h1>
   <p>{{item.year}} &#x2022; {{item.rated}} &#x2022; {{item.runtime}}</p>
<div class="media">
   <img class="align-self-start mr-3" src="{{item.poster}}" alt="{{item.title}}" style="width: 16rem">
   <div class="media-body">
     <!-- <h5 class="mt-0">{{item.title}}</h5> -->
      <h5>Director: {{item.director}}</h5>
      <h5>Stars: {{item.actors}}</h5>
     <p>{{item.plot}}</p>
     <p class="text-muted">{{item.genre}}</p>
     <p class="text-muted">Metascore: {{item.metascore}}</p>
     <p class="text-muted">IMDB Rating: {{item.imdbRating}}</p>
   </div>
 </div>
 {% if in_watchlist %}
         <form action="{% url '_remove_mylist' %}" method="POST">
            <button type="submit" class="btn btn-danger">Remove From My List</button>
         </form>
         {% else %}
         <form action="{% url '_add_mylist' %}" method="POST">
               {% csrf_token %}
                  <input type="hidden" name="imdbID" class="form-control" id="imdbID" value="{{item.imdbID}}">
                  <input type="hidden" name="poster" class="form-control" id="poster" value="{{item.poster}}">
                  <input type="hidden" name="title" class="form-control" id="title" value="{{item.title}}">
                  <input type="hidden" name="year" class="form-control" id="year" value="{{item.year}}">
                  <input type="hidden" name="type" class="form-control" id="type" value="{{item.type}}">
            <button type="submit" class="btn btn-success">Add To My List</button>
         </form>
         {% endif %}
</div>

<div class="row row-cols-1 row-cols-md-3 g-4">
</div>
<div class="d-flex p-4 justify-content-center">
   <div class="card m-3" style="width: 80%" data-id="{{item.imdbID}}">
      <div class="card-body">
         <!-- If user likes post, show like button as red; otherwise grey  -->
         <!-- {% if user.username in post.like.all|stringformat:'s' %}
          <button class="btn btn-danger float-left" id="foo">&hearts;&nbsp;<span id="number">{{ post.like.all.count }}</span></button> 
          {% else %}
          <button class="btn btn-secondary float-left" id="foo">&hearts;&nbsp;<span id="number">{{ post.like.all.count }}</span></button> 
          {% endif %} -->
         <!-- {% if in_watchlist %}
         <form action="{% url '_remove_mylist' %}" method="POST">
            <button type="submit" class="btn btn-danger">Remove From My List</button>
         </form>
         {% else %}
         <form action="{% url '_add_mylist' %}" method="POST">
               {% csrf_token %}
                  <input type="hidden" name="imdbID" class="form-control" id="imdbID" value="{{item.imdbID}}">
                  <input type="hidden" name="poster" class="form-control" id="poster" value="{{item.poster}}">
                  <input type="hidden" name="title" class="form-control" id="title" value="{{item.title}}">
                  <input type="hidden" name="year" class="form-control" id="year" value="{{item.year}}">
                  <input type="hidden" name="type" class="form-control" id="type" value="{{item.type}}">
            <button type="submit" class="btn btn-success">Add To My List</button>
         </form>
         {% endif %} -->
         <!-- <h5 class="card-subtitle mb-2 text-muted">year: {{item.year}}</h5>
         <h5 class="card-subtitle mb-2 text-muted">rated: {{item.rated}}</h5>
         <h5 class="card-subtitle mb-2 text-muted">released: {{item.released}}</h5>
         <h5 class="card-subtitle mb-2 text-muted">runtime: {{item.runtime}}</h5> -->
         <!-- <h5 class="card-subtitle mb-2 text-muted">genre: {{item.genre}}</h5> -->

         <!-- <h5 class="card-subtitle mb-2 text-muted">director: {{item.director}}</h5>
         <h5 class="card-subtitle mb-2 text-muted">actors: {{item.actors}}</h5>
         <h3 class="card-subtitle mb-2 text-muted">Plot: {{item.plot}}</h3> -->
         <h5 class="card-subtitle mb-2 text-muted">language: {{item.language}}</h5>
         <h5 class="card-subtitle mb-2 text-muted">awards: {{item.awards}}</h5>
         <h5 class="card-subtitle mb-2 text-muted">metascore: {{item.metascore}}</h5>
         <h5 class="card-subtitle mb-2 text-muted">votes: {{item.votes}}</h5>
         <h5 class="card-subtitle mb-2 text-muted">revenue: {{item.revenue}}</h5>

         <h6 class="card-subtitle mb-2 text-muted">budget: {{item.budget}}</h6>

         <h6 class="card-subtitle mb-2 text-muted">type: {{item.type}}</h6>
         <a href="https://www.imdb.com/title/{{item.imdbID}}/" target="_blank" class="card-subtitle mb-2 text-muted">IMDB: {{item.imdbID}}</a>

      </div>
   </div>

</div>
</br>
</br>


<script>
   document.addEventListener('DOMContentLoaded', function () {
      document.querySelectorAll('button').forEach(button => {
         button.onclick = function () {

            // Detects if LIKE button clicked
            if (this.className === "btn btn-secondary float-left" || this.className === "btn btn-danger float-left") {
               console.log(`Like button clicked. Post number: ${this.parentElement.parentElement.dataset.id}`)

               const element = event.target
               const id = element.parentElement.parentElement.dataset.id

               console.log(`Movie ID: ${id}`)

               // Update database then HTML
               fetch(`/like/${id}`), {
                  method: 'POST'
               }
               like(element);
            }
         }
      });
   });

   function like(post) {

      // Get current number of likes
      var likes = post.querySelector("#number").innerHTML

      // Increment / deincrement number of likes and change colour of button
      if (post.classList.contains("btn-secondary")) {

         post.className = "btn btn-danger float-left";
         likes++
         post.querySelector("#number").innerHTML = likes

      } else {

         post.className = "btn btn-secondary float-left";
         likes--
         post.querySelector("#number").innerHTML = likes
      }
   }

</script>

{% endblock %}
</div>